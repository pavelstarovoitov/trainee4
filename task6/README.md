"Задача №6 Нужно вывести загрузку CPU на страничку NGINX в реалтайме, потом создать демон процесс который будет писать раз в 5 секунд в файл логи NGINX
(при попытке грохнуть процесс, он должен перезапускаться) 
Когда файл достигнет размера больше чем 300 кб ну может 500 , ( суть в некотором наполнении ) файл лога должен очищаться 
В 2 файле должна присутствовать лог об удачных очистках файла с логами NGINX с датой и временем очистки. 

В 3 файл надо складывать отдельно логи с 500 ошибками 
В 4 файл надо складывать логи с 400 ми ошибками 

Логи NGNIX можно сохранять любые до каких сможешь дотянуться 

Для парсинга логов использовать sed или awk

если файл будет наполняться слишком быстро, увеличь тригер очистки корневого лог файла до 1 мб до 3 пока не станет комфортно работать с другими заданиями (Дедлайн 3 дня)"
***

### Нужно вывести загрузку CPU на страничку NGINX в реалтайме

### Чтобы получить инфорамцию о загрузке процессера использовал Python бибилотеку psutil

![image0001](image0001.png)

### Использую фрейворк Flask создал route '/cpu_load' по которому возращается значение полученное от psutil

![image0002](image0002.png)

### Создал route '/flask' для отрисовки html страницы

![image0003](image0003.png)

## [app.py](flask/app.py)


### На html странице создал JavasSript функцию, которая обаращется к route '/cpu_load' каждые 2 секунды

![image0004](image0004.png)

## [html страница с JavaScript функцией](flask/templates/index.html)


### В nginx.conf добавил проксирование на flask routes '/flask' и '/cpu_load' 

![image0005](image0005.png)

![image0006](image0006.png)

![image0007](image0007.png)

## [nginx.conf](nginx.conf)

## [ССылка на страницу загрузки процессора](https://trainee4.com/flask)

***

потом создать демон процесс который будет писать раз в 5 секунд в файл логи NGINX
(при попытке грохнуть процесс, он должен перезапускаться) 
Когда файл достигнет размера больше чем 300 кб ну может 500 , ( суть в некотором наполнении ) файл лога должен очищаться 
В 2 файле должна присутствовать лог об удачных очистках файла с логами NGINX с датой и временем очистки. 

В 3 файл надо складывать отдельно логи с 500 ошибками 
В 4 файл надо складывать логи с 400 ми ошибками 

Логи NGNIX можно сохранять любые до каких сможешь дотянуться 

Для парсинга логов использовать sed или awk

### Создаю log.service файл для демона процесса

![image0008](image0008.png)

### Параметр Restart=always отвечает за перазапуск демона 

![image0009](image0009.png)

## [log.service](log.service)

### Демон запускает скрипт nglog.sh, скрипт в бесконечном цикл while do каждые пять секунд записывает данные в файлы temp.log, 400.log, 500.log и flash.log

![image0010](image0010.png)

## [nglog.sh](nglog.sh)

### Файл temp.log содержит все логи. 

![image0011](image0011.png)

### Когд размер temp.log больше определенного числа temp.log очищается и информация о событии записывается в flash.log

![image0012](image0012.png) 

### Ошибки с кодами 400 и 500 записываются в 400.log и 500.log

![image0013](image0013.png)

![image0014](image0014.png)

## [Файлы логов](https://trainee4.com/logs)


### Для поиска кодов ошибок используется awk

![image0015](image0015.png)

















